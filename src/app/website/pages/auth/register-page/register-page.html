<!-- register-page.html -->

<div class="register-container">
  <div class="register-card">
    <!-- الصورة الجانبية -->
    <div class="register-image-section">
      <div class="image-content">
        <h3>انضم إلينا اليوم!</h3>
        <p>
          أنشئ حسابك الآن واستمتع بتجربة تسوق فريدة مع أحدث صيحات الموضة الكاجوال للرجال والنساء.
        </p>

        <ul class="features-list">
          <li>
            <span>عروض حصرية لأعضاء الموقع</span>
            <i class="bi bi-check-circle-fill"></i>
          </li>
          <li>
            <span>توصيل سريع ومجاني للطلبات الأولى</span>
            <i class="bi bi-check-circle-fill"></i>
          </li>
          <li>
            <span>سهولة إرجاع المنتجات</span>
            <i class="bi bi-check-circle-fill"></i>
          </li>
          <li>
            <span>متابعة الطلبات لحظة بلحظة</span>
            <i class="bi bi-check-circle-fill"></i>
          </li>
          <li>
            <span>نقاط مكافآت لكل عملية شراء</span>
            <i class="bi bi-check-circle-fill"></i>
          </li>
        </ul>
      </div>
    </div>

    <!-- نموذج التسجيل -->
    <div class="register-form-section">
      <div class="brand-logo">
        <h2><i class="bi bi-shop-window"></i> FashionHub</h2>
        <p>متجر الملابس الكاجوال للرجال والنساء</p>
      </div>

      <!-- شريط التقدم -->
      <div class="progress-steps">
        @for (step of [1, 2, 3]; track step) {
          <div
            class="step"
            [class.active]="currentStep() >= step"
            [class.completed]="currentStep() > step"
            (click)="goToStep(step)"
          >
            <div class="step-circle">
              @if (currentStep() > step) {
                <i class="bi bi-check"></i>
              } @else {
                {{ step }}
              }
            </div>
            <div class="step-text">
              {{ step === 1 ? 'المعلومات الشخصية' : step === 2 ? 'تفاصيل الحساب' : 'الإعدادات' }}
            </div>
          </div>
        }
      </div>

      <!-- رسائل الخطأ -->
      @if (authService.registerError()) {
        <div class="alert alert-danger">
          <i class="bi bi-exclamation-triangle-fill me-2"></i>
          {{ authService.registerError() }}
        </div>
      }

      <form [formGroup]="registerForm" (ngSubmit)="onRegister()">
        <!-- الخطوة 1 -->
        @if (currentStep() === 1) {
          <div class="form-step" @fadeIn>
            <div class="row">
              <div class="col-md-6">
                <div class="form-group">
                  <label class="form-label">الاسم الأول *</label>
                  <div class="input-group">
                    <input
                      type="text"
                      class="form-control"
                      formControlName="firstName"
                      [class.is-invalid]="
                        registerForm.get('firstName')?.touched &&
                        registerForm.get('firstName')?.invalid
                      "
                      placeholder="أدخل اسمك الأول"
                    />
                    <div class="input-group-icon"><i class="bi bi-person"></i></div>
                  </div>
                  @if (
                    registerForm.get('firstName')?.touched && registerForm.get('firstName')?.invalid
                  ) {
                    <div class="invalid-feedback d-block">الاسم الأول مطلوب</div>
                  }
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label class="form-label">اسم العائلة *</label>
                  <div class="input-group">
                    <input
                      type="text"
                      class="form-control"
                      formControlName="lastName"
                      [class.is-invalid]="
                        registerForm.get('lastName')?.touched &&
                        registerForm.get('lastName')?.invalid
                      "
                      placeholder="أدخل اسم العائلة"
                    />
                    <div class="input-group-icon"><i class="bi bi-person"></i></div>
                  </div>
                </div>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">البريد الإلكتروني *</label>
              <div class="input-group">
                <input
                  type="email"
                  class="form-control"
                  formControlName="email"
                  [class.is-invalid]="
                    registerForm.get('email')?.touched && registerForm.get('email')?.invalid
                  "
                  placeholder="example@email.com"
                />
                <div class="input-group-icon"><i class="bi bi-envelope"></i></div>
              </div>
              @if (
                registerForm.get('email')?.touched && registerForm.get('email')?.errors?.['email']
              ) {
                <div class="invalid-feedback d-block">البريد الإلكتروني غير صحيح</div>
              }
            </div>

            <div class="form-group">
              <label class="form-label">رقم الهاتف *</label>
              <div class="input-group">
                <input
                  type="tel"
                  class="form-control"
                  formControlName="phone"
                  [class.is-invalid]="
                    registerForm.get('phone')?.touched && registerForm.get('phone')?.invalid
                  "
                  placeholder="05XXXXXXXX"
                />
                <div class="input-group-icon"><i class="bi bi-telephone"></i></div>
              </div>
            </div>

            <div class="form-navigation">
              <button type="button" class="btn btn-prev" disabled>
                <i class="bi bi-chevron-right me-2"></i> السابق
              </button>
              <button type="button" class="btn btn-next" (click)="nextStep()">
                التالي <i class="bi bi-chevron-left ms-2"></i>
              </button>
            </div>
          </div>
        }

        <!-- الخطوة 2 -->
        @if (currentStep() === 2) {
          <div class="form-step" @fadeIn>
            <div class="form-group">
              <label class="form-label">كلمة المرور *</label>
              <div class="input-group">
                <input
                  [type]="showPassword() ? 'text' : 'password'"
                  class="form-control"
                  formControlName="password"
                  placeholder="أدخل كلمة مرور قوية"
                />
                <div class="input-group-icon"><i class="bi bi-lock"></i></div>
                <button type="button" class="toggle-password" (click)="togglePassword('password')">
                  <i
                    class="bi"
                    [class.bi-eye]="!showPassword()"
                    [class.bi-eye-slash]="showPassword()"
                  ></i>
                </button>
              </div>

              <!-- مؤشر قوة كلمة المرور -->
              <div class="password-strength">
                <div class="strength-bar">
                  <div
                    class="strength-fill"
                    [style.width.%]="getPasswordStrength().percent"
                    [style.background]="getPasswordStrength().color"
                  ></div>
                </div>
                <div class="strength-text">قوة كلمة المرور: {{ getPasswordStrength().level }}</div>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">تأكيد كلمة المرور *</label>
              <div class="input-group">
                <input
                  [type]="showConfirmPassword() ? 'text' : 'password'"
                  class="form-control"
                  formControlName="confirmPassword"
                  [class.is-invalid]="
                    registerForm.get('confirmPassword')?.touched &&
                    registerForm.hasError('mismatch')
                  "
                  placeholder="أعد إدخال كلمة المرور"
                />
                <div class="input-group-icon"><i class="bi bi-lock-fill"></i></div>
                <button type="button" class="toggle-password" (click)="togglePassword('confirm')">
                  <i
                    class="bi"
                    [class.bi-eye]="!showConfirmPassword()"
                    [class.bi-eye-slash]="showConfirmPassword()"
                  ></i>
                </button>
              </div>
              @if (
                registerForm.hasError('mismatch') && registerForm.get('confirmPassword')?.touched
              ) {
                <div class="invalid-feedback d-block">كلمات المرور غير متطابقة</div>
              }
            </div>

            <div class="form-navigation">
              <button type="button" class="btn btn-prev" (click)="prevStep()">
                <i class="bi bi-chevron-right me-2"></i> السابق
              </button>
              <button type="button" class="btn btn-next" (click)="nextStep()">
                التالي <i class="bi bi-chevron-left ms-2"></i>
              </button>
            </div>
          </div>
        }

        <!-- الخطوة 3 -->
        @if (currentStep() === 3) {
          <div class="form-step" @fadeIn>
            <div class="form-group">
              <label class="form-label">تاريخ الميلاد</label>
              <div class="input-group">
                <input type="date" class="form-control" formControlName="birthDate" />
                <div class="input-group-icon"><i class="bi bi-calendar"></i></div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6">
                <div class="form-group">
                  <label class="form-label">الدولة</label>
                  <select class="form-control" formControlName="country">
                    <option value="">اختر الدولة</option>
                    <option value="SA">السعودية</option>
                    <option value="AE">الإمارات</option>
                    <option value="QA">قطر</option>
                    <option value="KW">الكويت</option>
                    <option value="EG">مصر</option>
                  </select>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label class="form-label">المدينة</label>
                  <input
                    type="text"
                    class="form-control"
                    formControlName="city"
                    placeholder="المدينة"
                  />
                </div>
              </div>
            </div>

            <div class="form-group">
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  formControlName="newsletter"
                  id="newsletter"
                />
                <label class="form-check-label" for="newsletter">
                  أرغب في تلقي آخر العروض والتحديثات
                </label>
              </div>
            </div>

            <div class="form-group">
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  formControlName="terms"
                  id="terms"
                  [class.is-invalid]="
                    registerForm.get('terms')?.touched && registerForm.get('terms')?.invalid
                  "
                />
                <label class="form-check-label" for="terms">
                  أوافق على
                  <a href="#" data-bs-toggle="modal" data-bs-target="#termsModal"
                    >الشروط والأحكام</a
                  >
                  *
                </label>
              </div>
            </div>

            <div class="form-navigation">
              <button type="button" class="btn btn-prev" (click)="prevStep()">
                <i class="bi bi-chevron-right me-2"></i> السابق
              </button>
              <button
                type="submit"
                class="btn btn-register"
                [disabled]="authService.isLoading() || registerForm.invalid"
              >
                @if (authService.isLoading()) {
                  <span class="spinner-border spinner-border-sm me-2"></span>
                  جاري إنشاء الحساب...
                } @else {
                  <i class="bi bi-person-plus me-2"></i> إنشاء الحساب
                }
              </button>
            </div>
          </div>
        }
      </form>

      <div class="register-footer">
        <p>لديك حساب بالفعل؟ <a routerLink="/login">سجل دخولك هنا</a></p>
      </div>
    </div>
  </div>
</div>
